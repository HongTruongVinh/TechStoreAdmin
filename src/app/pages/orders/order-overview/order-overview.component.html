<!-- Start Breadcrumbs -->
<app-breadcrumbs title="Order Overview" [breadcrumbItems]="breadCrumbItems"></app-breadcrumbs>
<!-- End Breadcrumbs -->

<div class="row">
    <div class="col-lg-12">
        <div class="card">
            <div class="card-body d-flex align-items-center flex-wrap gap-3">
                <div class="flex-grow-1">
                    <p class="text-muted mb-2">Mã đơn hàng</p>
                    <h6 class="fs-md mb-0">#{{orderDetail.orderId}}</h6>
                </div>
                <div class="flex-shrink-0 text-end">
                    <h6 class="fs-md mb-2">{{orderDetail.createdAt | dateToString:'getDate'}}<i
                            class="bi bi-calendar4-event align-baseline ms-1"></i></h6>
                    <p class="text-muted mb-0">{{orderDetail.createdAt | dateToString:'getTime'}} <i
                            class="bi bi-clock align-baseline ms-1"></i></p>
                </div>
                <div class="flex-shrink-0">
                    <a routerLink="/invoices/overview" class="btn btn-primary"><i
                            class="ph-download-simple align-middle me-1"></i> In hóa đơn</a>
                </div>
            </div>
        </div><!--end card-->
    </div><!--end col-->
</div><!--end row-->

<div class="row">
    <div class="col-xxl-3 col-md-6">
        <div class="card border-bottom border-2 border-secondary">
            <div class="card-body d-flex gap-3">
                <div class="flex-grow-1">
                    <h6 class="card-title mb-3">Thông tin khách hàng</h6>
                    <p class="fw-medium fs-md mb-1">{{orderDetail.customerName}}</p>
                    <p class="text-muted mb-1">{{orderDetail.customerPhonenumber}}</p>
                    <p class="text-muted mb-0">{{orderDetail.shippingAddress}}</p>
                </div>
                <div class="flex-shrink-0">
                    <img src="assets/images/users/48/avatar-1.jpg" alt="" class="avatar-sm rounded img-thumbnail">
                </div>
            </div>
        </div>
    </div><!--end col-->
    <div class="col-xxl-3 col-md-6">
        <div class="card border-bottom border-2 border-primary">
            <div class="card-body d-flex gap-3">
                <div class="flex-grow-1">
                    <h6 class="card-title mb-3">Thông tin giao hàng</h6>
                    <p class="fw-medium fs-md mb-1">Đơn vị: {{orderDetail.shipperName??'chưa có'}}</p>
                    <p class="text-muted mb-1">Mã vận đơn: {{orderDetail.trackingNumber??'chưa có'}}</p>
                    <p class="text-muted mb-0">Dự kiến giao: {{orderDetail.estimatedArrival? (orderDetail.estimatedArrival | dateToString:'getDate') : 'chưa có'}}</p>
                </div>
                <div class="flex-shrink-0">
                    <div class="avatar-sm">
                        <div class="avatar-title bg-primary-subtle text-primary fs-3 rounded">
                            <i class="ph-truck"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div><!--end col-->
    <div *ngIf="orderDetail.invoice" class="col-xxl-3 col-md-6">
        <div class="card border-bottom border-2 border-info">
            <div class="card-body d-flex gap-3">
                <div class="flex-grow-1">
                    <h6 class="card-title mb-3">Thông tin hóa đơn</h6>
                    <p class="fw-medium fs-md mb-1">{{orderDetail.invoice.invoiceId}}</p>
                    <p class="text-muted mb-1">Thanh toán: {{orderDetail.paymentMethod  | paymentMethod}}</p>
                    <p class="text-muted mb-0">Trạng thái: {{orderDetail.invoice.invoiceStatus | invoiceStatus}}</p>
                </div>
                <div class="flex-shrink-0">
                    <div class="avatar-sm">
                        <div class="avatar-title bg-info-subtle text-info fs-3 rounded">
                            <i class="ph-file-text"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div><!--end col-->
    <div *ngIf="orderDetail.payment" class="col-xxl-3 col-md-6">
        <div class="card border-bottom border-2 border-light">
            <div class="card-body d-flex gap-3">
                <div class="flex-grow-1">
                    <h6 class="card-title mb-3">Thông tin thanh toán</h6>
                    <p class="fw-medium fs-md mb-1">ID: #TBS3650259845</p>
                    <p class="text-muted mb-1">Payment Method: <b>{{orderDetail.payment.paymentMethod }}</b></p>
                    <p class="text-muted mb-0">Transaction Number: <b>{{orderDetail.payment.transactionCode }}</b></p>
                </div>
                <div class="flex-shrink-0">
                    <div class="avatar-sm">
                        <div class="avatar-title bg-light text-body fs-3 rounded">
                            <i class="ph-currency-circle-dollar"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div><!--end col-->
</div><!--end row-->

<div class="row">
    <div class="col-xxl-9">
        <div class="card">
            <div class="card-header d-flex align-items-center gap-3">
                <h6 class="card-title mb-0 flex-grow-1">Các mặt hàng</h6>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table align-middle table-nowrap table-borderless">
                        <thead class="table-active">
                            <tr>
                                <th>Mặt hàng</th>
                                <th>Đơn giá</th>
                                <th>Số lượng</th>
                                <th class="text-end">Thành tiền</th>
                            </tr>
                        </thead>
                        <tbody>
                            @for (orderItem of orderDetail.items; track $index)
                            {
                            <tr>
                                <td>
                                    <div class="product-item d-flex align-items-center gap-2">
                                        <div class="avatar-sm flex-shrink-0">
                                            <div class="avatar-title bg-light rounded">
                                                <img [src]="orderItem.mainImageUrl | fullImageUrl" alt="" class="avatar-xs">
                                            </div>
                                        </div>
                                        <div class="flex-grow-1">
                                            <h6 class="fs-md"><a routerLink="/ecommerce/product-details"
                                                    class="text-reset">{{orderItem.productName}}</a></h6>
                                            <p class="text-muted mb-0"><a href="javascript:void(0);"
                                                    class="text-reset">{{orderItem.categoryName}}</a></p>
                                        </div>
                                    </div>
                                </td>
                                <td>{{orderItem.priceAtOrderTime | thousandSeparator}} VND</td>
                                <td>{{orderItem.quantity}}</td>
                                <td class="fw-medium text-end">{{orderItem.totalPrice | thousandSeparator}} VND</td>
                            </tr>
                            }
                        </tbody>
                    </table>
                </div>
                <div class="row gy-3">
                    <div class="col-sm-6 col-lg-6 col-xl-3">
                        <div class="text-center border border-dashed p-3 rounded">
                            <p class="text-muted mb-2">Ngày đặt hàng</p>
                            <h6 class="fs-md mb-0">{{orderDetail.createdAt | dateToString:'getDate'}}</h6>
                        </div>
                    </div>
                    <div class="col-sm-6 col-lg-6 col-xl-3">
                        <div class="text-center border border-dashed p-3 rounded">
                            <p class="text-muted mb-2">Ngày vận chuyển</p>
                            <h6 class="fs-md mb-0">{{orderDetail.updatedAt | dateToString:'getDate'}}</h6>
                        </div>
                    </div>
                    <div class="col-sm-6 col-lg-6 col-xl-3">
                        <div class="text-center border border-dashed p-3 rounded">
                            <p class="text-muted mb-2">Trạng thái</p>
                            <h6 class="fs-md mb-0" [ngClass]="orderDetail.orderStatus | orderStatus:'class'">
                                {{ orderDetail.orderStatus | orderStatus:'label' }}
                            </h6>
                        </div>
                    </div>
                    <div class="col-sm-6 col-lg-6 col-xl-3">
                        <div class="text-center border border-dashed p-3 rounded">
                            <p class="text-muted mb-2">Tổng tiền</p>
                            <h6 class="fs-md mb-0">{{orderDetail.finalAmount| thousandSeparator}} VND</h6>
                        </div>
                    </div>
                </div>
            </div>
        </div><!--end card-->
    </div><!--end col-->
    <div class="col-xxl-3">
        <div class="row">
            <div class="col-xxl-12 col-lg-6">
                <div class="card">
                    <div class="card-header">
                        <h6 class="card-title mb-0">Tổng thanh toán</h6>
                    </div>
                    <div class="card-body pt-4">
                        <div class="table-responsive table-card">
                            <table class="table table-borderless mb-0">
                                <tbody>
                                    <tr>
                                        <td>Giá tổng sản phẩm :</td>
                                        <td class="text-end">{{orderDetail.totalPrice| thousandSeparator}}</td>
                                    </tr>
                                    <tr>
                                        <td>Giảm giá :</td>
                                        <td class="text-end">-{{orderDetail.discountAmount | thousandSeparator}}</td>
                                    </tr>
                                    <tr>
                                        <td>Phí giao hàng :</td>
                                        <td class="text-end">{{orderDetail.shippingCharge | thousandSeparator}}</td>
                                    </tr>
                                    <tr>
                                        <td>Thuế ước tính :</td>
                                        <td class="text-end">0</td>
                                    </tr>
                                    <tr class="border-top border-top-dashed">
                                        <th scope="row">Tổng (VND) :</th>
                                        <th class="text-end">{{orderDetail.finalAmount | thousandSeparator}} VND</th>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            <!--end col-->
            <div class="col-xxl-12 col-lg-6">
                <div class="card">
                    <div class="card-body">
                        <div class="d-flex align-items-center">
                            <h5 class="card-title flex-grow-1 mb-0">Trạng thái đơn hàng</h5>
                            <div class="flex-shrink-0">
                                <a href="javascript:void(0);" class="badge bg-secondary-subtle text-secondary">Track
                                    Order</a>
                            </div>
                        </div>
                    </div>
                    <div class="card-body border-top border-dashed">
                        <div>
                            <p class="text-muted mb-2 mb-md-0">Quét mã QR để theo dõi đơn hàng </p>
                            <div class="text-center p-3 pb-0">
                                <!-- <img alt="Scan Me!" src="assets/images/barcode.svg" class="img-fluid"> -->
                                <div *ngIf="orderDetail.qrCode"><img [src]="orderDetail.qrCode  | base64Image " alt="QR Code" class="qr-small">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!--end col-->
        </div><!--end row-->
    </div><!--end col-->
</div><!--end row-->

<div class="row">
    <div class="col-lg-12">
        <div class="card">
            <div class="card-header d-flex align-items-center flex-wrap gap-2">
                <h6 class="card-title flex-grow-1 mb-0">Tiến trình đơn hàng</h6>
                <div class="flex-shrink-0">
                    <button type="button" class="btn btn-danger btn-sm me-1"><i class="ph-x align-middle"></i> Cancel
                        Order</button>
                    <a routerLink="/invoices/overview" class="btn btn-primary btn-sm"><i
                            class="ph-download-simple align-middle "></i> Invoice</a>
                </div>
            </div>
            <div class="card-body">
                <div class="progress progress-step-arrow progress-info mb-4">

                    <a href="javascript:void(0);" class="progress-bar" [ngClass]="{
                                     'active': orderDetail.orderStatus >= 0
                                   }" role="progressbar" style="width: 100%">
                        <i class="ph-bag align-baseline me-1 d-none d-lg-inline-block"></i> 
                        {{ orderDetail.orderStatus === 0 ? (orderDetail.orderStatus | orderStatus:'label') : 'Đang chờ duyệt'
                        }}
                    </a>

                    <a href="javascript:void(0);" class="progress-bar" [ngClass]="{
                                     'active': orderDetail.orderStatus >= 1
                                   }" role="progressbar" style="width: 100%">
                        <i class="ph-package align-middle me-1"></i> 
                        {{ orderDetail.orderStatus === 1 ? (orderDetail.orderStatus | orderStatus:'label') : 'Đang đóng gói'
                        }}
                    </a>

                    <a href="javascript:void(0);" class="progress-bar" [ngClass]="{
                                     'active': orderDetail.orderStatus >= 2,
                                     'pending': orderDetail.orderStatus === 2
                                   }" role="progressbar" style="width: 100%">
                        <i class="ph-truck align-baseline me-1 d-none d-lg-inline-block"></i>
                        {{ orderDetail.orderStatus === 2 ? (orderDetail.orderStatus | orderStatus:'label') : 'Đang vận chuyển'
                        }}
                    </a>

                    <a href="javascript:void(0);" class="progress-bar" [ngClass]="{
                                     'active': orderDetail.orderStatus >= 3
                                   }" role="progressbar" style="width: 100%">
                        <i class="ph-bicycle align-baseline me-1 d-none d-lg-inline-block"></i>
                        Đang chờ giao hàng
                    </a>

                    <a href="javascript:void(0);" class="progress-bar" [ngClass]="{
                                     'active': orderDetail.orderStatus === 3 || orderDetail.orderStatus === 4
                                   }" role="progressbar" style="width: 100%">
                        <i class="ph-house-line align-baseline me-1 d-none d-lg-inline-block"></i>
                        {{ orderDetail.orderStatus === 3 || orderDetail.orderStatus === 4 ? (orderDetail.orderStatus |
                        orderStatus:'label') : 'Đã giao hàng' }}
                    </a>
                </div>

                <!-- <div id="map" class="leaflet-map leaflet-gray" style="height: 380px;"></div> -->
            </div>

        </div>
    </div><!--end col-->
</div><!--end row-->