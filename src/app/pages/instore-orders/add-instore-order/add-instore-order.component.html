<!-- Start Breadcrumbs -->
<app-breadcrumbs title="Order Overview" [breadcrumbItems]="breadCrumbItems"></app-breadcrumbs>
<!-- End Breadcrumbs -->

<div class="row">
    <div class="col-lg-12">
        <div class="card">
            <div class="card-body d-flex align-items-center flex-wrap gap-3">
                <div class="flex-grow-1">
                    <p class="text-muted mb-2">Mã đơn hàng</p>
                    <h6 class="fs-md mb-0">#</h6>
                </div>
                <div class="flex-shrink-0">
                    <a (click)="goToCheckout()" class="btn btn-success"><i
                            class="bi bi-currency-dollar align-middle me-1"></i> Đến trang thanh toán</a>
                </div>
            </div>
        </div><!--end card-->
    </div><!--end col-->
</div><!--end row-->

<div class="row">
    <div class="col-xxl-6 col-md-6">
        <div class="card border-bottom border-2 border-secondary">
            <div class="card-body d-flex gap-3">
                <div class="flex-grow-1">
                    <h6 class="card-title mb-3">Khách hàng</h6>
                    <form (ngSubmit)="saveAction()" [formGroup]="newOrderForm" class="tablelist-form" novalidate
                        autocomplete="off">

                        <div class="d-flex align-items-center mb-3">
                            <label for="customerName" class="form-label me-3 mb-0" style="width: 120px;">Tên <span
                                    class="text-danger">*</span></label>
                            <input formControlName="customerName" type="text" class="form-control" id="customerName"
                                placeholder="Nhập tên khách hàng" required>
                        </div>

                        <div class="d-flex align-items-center mb-3">
                            <label for="customerPhoneNumber" class="form-label me-3 mb-0" style="width: 120px;">SĐT
                                <span class="text-danger">*</span></label>
                            <input formControlName="customerPhoneNumber" type="text" class="form-control"
                                id="customerPhoneNumber" placeholder="Nhập số điện thoại" required>
                        </div>

                    </form>

                </div>
                <div class="flex-shrink-0">
                    <img src="assets/images/users/48/avatar-1.jpg" alt="" class="avatar-sm rounded img-thumbnail">
                </div>
            </div>
        </div>
    </div><!--end col-->
    <div class="col-xxl-6 col-md-6">
        <div class="card border-bottom border-2 border-info">
            <div class="card-body d-flex gap-3">
                <div class="flex-grow-1">
                    <h6 class="card-title mb-3">Thông tin hóa đơn</h6>
                    <div class="d-flex align-items-center mb-3">
                        <label for="cashierName" class="form-label me-3 mb-0" style="width: 120px;">Người lập:</label>
                        <input type="text" class="form-control" id="cashierName" value="{{cashierName}}" readonly>
                    </div>
                    <div class="d-flex align-items-center mb-3">
                        <label for="paymentMethod" class="form-label me-3 mb-0" style="width: 120px;">Phương
                            thức:</label>
                        <select [(ngModel)]="selectedpaymentMethodId" class="form-select">
                            <option *ngFor="let paymentMethod of paymentMethods" [value]="paymentMethod.methodId">
                                {{ paymentMethod.name }}
                            </option>
                        </select>
                    </div>
                </div>
                <div class="flex-shrink-0">
                    <div class="avatar-sm">
                        <div class="avatar-title bg-info-subtle text-info fs-3 rounded">
                            <i class="ph-file-text"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div><!--end col-->
</div><!--end row-->

<div class="row">
    <div class="col-xxl-9">
        <div class="card">
            <div class="card-header d-flex align-items-center gap-3">
                <h6 class="card-title mb-0 flex-grow-1">Các mặt hàng</h6>
                <div class="flex-shrink-0">
                    <div class="search-box">
                        <input type="text" class="form-control search" [(ngModel)]="term" (keyup)="searchProduct()"
                            placeholder="Tìm kiếm sản phẩm">
                        <i class="ri-search-line search-icon"></i>
                    </div>
                </div>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table align-middle table-nowrap table-borderless">
                        <thead class="table-active">
                            <tr>
                                <th></th>
                                <th>Mặt hàng</th>
                                <th>Đơn giá</th>
                                <th>Số lượng</th>
                                <th class="text-end">Thành tiền</th>
                            </tr>
                        </thead>
                        <tbody>
                            @for (orderItem of cartData; track $index)
                            {
                            <tr>
                                <td>
                                    <ul class="d-flex gap-2 list-unstyled mb-0">

                                        <li>
                                            <a href="javascript:void(0);"
                                                class="btn btn-subtle-danger btn-icon btn-sm remove-item-btn"
                                                (click)="removeOrderItem(orderItem.productId)"><i
                                                    class="ph-trash"></i></a>
                                        </li>
                                    </ul>
                                </td>
                                <td>
                                    <div class="product-item d-flex align-items-center gap-2">
                                        <div class="avatar-sm flex-shrink-0">
                                            <div class="avatar-title bg-light rounded">
                                                <img [src]="orderItem.mainImageUrl | fullImageUrl" alt=""
                                                    class="avatar-xs">
                                            </div>
                                        </div>
                                        <div class="flex-grow-1">
                                            <h6 class="fs-md"><a routerLink="/ecommerce/product-details"
                                                    class="text-reset">{{orderItem.productName}}</a></h6>
                                            <p class="text-muted mb-0"><a href="javascript:void(0);"
                                                    class="text-reset">{{orderItem.productId}}</a></p>
                                        </div>
                                    </div>
                                </td>
                                <td>{{orderItem.priceAtOrderTime | thousandSeparator}} VND</td>
                                <td>
                                    <div class="input-step">
                                        <button type="button" class="minus"
                                            (click)="calculateQty('0',orderItem.quantity,$index)">–</button>
                                        <input type="number" class="product-quantity" value="{{orderItem.quantity}}"
                                            min="0" max="100" readonly>
                                        <button type="button" class="plus"
                                            (click)="calculateQty('1',orderItem.quantity,$index)">+</button>
                                    </div>
                                </td>
                                <td class="fw-medium text-end">{{orderItem.totalPrice | thousandSeparator}} VND</td>
                            </tr>
                            }
                        </tbody>
                    </table>

                    <div *ngIf="isLoading" id="elmLoader">
                        <div class="spinner-border text-primary avatar-sm" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                    </div>
                </div>
            </div>
        </div><!--end card-->
    </div><!--end col-->
    <div class="col-xxl-3">
        <div class="row">
            <div class="col-xxl-12 col-lg-6">
                <div class="card">
                    <div class="card-header">
                        <h6 class="card-title mb-0">Tổng thanh toán</h6>
                    </div>
                    <div class="card-body pt-4">
                        <div class="table-responsive table-card">
                            <table class="table table-borderless mb-0">
                                <tbody>
                                    <tr>
                                        <td>Giá tổng sản phẩm :</td>
                                        <td class="text-end">{{subtotal | thousandSeparator}}</td>
                                    </tr>
                                    <tr>
                                        <td>Giảm giá :</td>
                                        <td class="text-end">-{{discount | thousandSeparator}}
                                        </td>
                                    </tr>
                                    <tr class="border-top border-top-dashed">
                                        <th scope="row">Tổng (VND) :</th>
                                        <th class="text-end">{{totalprice| thousandSeparator}} VND</th>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            <!--end col-->
        </div><!--end row-->
    </div><!--end col-->
</div><!--end row-->


<!--Search Modal-->
<div *ngIf="true" bsModal #searchModal="bs-modal" class="modal fade" id="searchModal">
    <div class="modal-dialog">
        <div class="modal-content border-0">
            <div class="modal-body">
                @for (data of displayedProducts; track $index) {
                <div class="d-flex gap-2 align-items-center position-relative mb-3" (click)="selectProduct(data)">
                    <div class="flex-shrink-0">
                        <img [src]="data.mainImageUrl | fullImageUrl" alt="" height="44"
                            class="object-fit-cover rounded">
                    </div>
                    <div class="flex-grow-1">
                        <a routerLink="/real-estate/producty-overview" class="stretched-link">
                            <h6>{{data.name}}</h6>
                        </a>
                        <ul class="d-flex align-items-center gap-2 flex-wrap list-unstyled mb-0">
                            <li>
                                <p class="text-muted mb-0"><i class="bi bi-bag align-baseline text-primary me-1"></i>
                                    {{data.soldCount}} đã bán</p>
                            </li>
                            <li>
                                <p class="text-muted mb-0"><i
                                        class="bi bi-chat-right-dots align-middle text-primary me-1"></i>
                                    {{data.ratedCount}} đánh giá</p>
                            </li>
                            <li>
                                <p class="text-muted mb-0"><i class="bi bi-house align-baseline text-primary me-1"></i>
                                    {{data.stock}} trong kho
                                </p>
                            </li>
                        </ul>
                    </div>
                    <div class="flex-shrink-0">
                        <span class="badge bg-warning-subtle text-warning"><i class="bi bi-star-fill text-warning"></i>
                            {{data.averageRating}}</span>
                    </div>
                </div>
                }
            </div>
        </div>
        <!-- modal-content -->
    </div>
</div><!--end modal-->